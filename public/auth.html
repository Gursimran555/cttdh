<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login / Signup</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">
  <div class="container mx-auto p-6">
    <div class="max-w-md mx-auto bg-white p-6 rounded-lg shadow">
      <h1 id="formTitle" class="text-2xl font-bold mb-4">Login</h1>
      <form id="authForm">
        <!-- Signup Fields (Hidden by Default) -->
        <div id="signupFields">
          <div class="mb-4">
            <label for="fullName" class="block text-sm font-medium text-gray-700">Full Name</label>
            <input type="text" id="fullName" class="mt-1 block w-full p-2 border rounded">
          </div>
          <div class="mb-4">
            <label for="mobile" class="block text-sm font-medium text-gray-700">Mobile</label>
            <input type="text" id="mobile" class="mt-1 block w-full p-2 border rounded">
          </div>
        </div>

        <!-- Common Fields -->
        <div class="mb-4">
          <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
          <input type="email" id="email" class="mt-1 block w-full p-2 border rounded" required>
        </div>
        <div class="mb-4">
          <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
          <input type="password" id="password" class="mt-1 block w-full p-2 border rounded" required>
        </div>

        <button type="submit" class="w-full bg-indigo-600 text-white px-4 py-2 rounded">
          Login
        </button>
        <p id="toggleLink" class="mt-4 text-center text-blue-500 cursor-pointer">
          Don't have an account? Signup
        </p>
      </form>
    </div>
  </div>

  <script>
    const authForm = document.getElementById('authForm');
    const toggleLink = document.getElementById('toggleLink');
    const formTitle = document.getElementById('formTitle');
    const signupFields = document.getElementById('signupFields');
    const fullNameInput = document.getElementById('fullName');
    const mobileInput = document.getElementById('mobile');
    let isLogin = true;

    // Hide signup fields by default
    signupFields.style.display = 'none';

    toggleLink.addEventListener('click', () => {
      isLogin = !isLogin;
      formTitle.textContent = isLogin ? 'Login' : 'Signup';
      toggleLink.textContent = isLogin ? "Don't have an account? Signup" : 'Already have an account? Login';
      signupFields.style.display = isLogin ? 'none' : 'block';

      // Toggle the required attribute based on the form state
      if (isLogin) {
        fullNameInput.removeAttribute('required');
        mobileInput.removeAttribute('required');
      } else {
        fullNameInput.setAttribute('required', '');
        mobileInput.setAttribute('required', '');
      }
    });

    authForm.addEventListener('submit', e => {
      e.preventDefault();

      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      if (!isLogin) {
        const fullName = fullNameInput.value;
        const mobile = mobileInput.value;

        if (!fullName || !mobile || !email || !password) {
          alert('All fields are required for signup.');
          return;
        }
      }

      const payload = isLogin ? { email, password } : {
        fullName: fullNameInput.value,
        mobile: mobileInput.value,
        email,
        password,
      };

      fetch(isLogin ? '/login' : '/signup', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload),
      })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            localStorage.setItem('token', data.token);
            window.location.href = '/';
          } else {
            alert(data.message);
          }
        })
        .catch(err => console.error('Error:', err));
    });
  </script>
</body>
</html>