<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wishlist</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">
  <header class="bg-white shadow">
    <div class="container mx-auto p-4 flex justify-between items-center">
      <a href="/" class="text-indigo-600 text-xl font-bold">eCommerce Store</a>
      <a href="/" class="text-gray-700 hover:text-indigo-600">Back to Home</a>
    </div>
  </header>

  <main class="container mx-auto p-5">
    <h1 class="text-3xl font-bold mb-6">Your Wishlist</h1>
    
    <div id="wishlistItems" class="bg-white p-6 rounded-lg shadow-lg">
      <p id="emptyWishlistMessage" class="text-center text-gray-500">Loading your wishlist...</p>
    </div>
  </main>

  <footer class="mt-10 p-4 bg-white shadow text-center text-gray-600">
    Â© 2024 eCommerce Store. All rights reserved.
  </footer>

  <script>
    const token = localStorage.getItem('token');
    if (!token) {
      alert('Please login to access your wishlist.');
      window.location.href = '/auth.html';
    }

    const wishlistItemsContainer = document.getElementById('wishlistItems');
    const emptyWishlistMessage = document.getElementById('emptyWishlistMessage');

    fetch('/wishlist', {
      headers: { Authorization: `Bearer ${token}` },
    })
    .then(res => res.json())
    .then(wishlistItems => {
      emptyWishlistMessage.style.display = 'none';

      if (wishlistItems.length === 0) {
        wishlistItemsContainer.innerHTML = '<p class="text-center text-gray-500">Your wishlist is empty.</p>';
        return;
      }

      wishlistItems.forEach(item => {
        const wishlistItem = document.createElement('div');
        wishlistItem.className = 'flex justify-between items-center border-b pb-4 mb-4';
        wishlistItem.innerHTML = `
          <div class="flex items-center">
            <img src="${item.image}" alt="${item.name}" class="w-16 h-16 rounded mr-4">
            <div>
              <h3 class="font-bold">${item.name}</h3>
              <p class="text-green-500 font-bold">$${item.price}</p>
            </div>
          </div>
          <div class="text-right">
            <button class="text-red-600 hover:text-red-800" onclick="removeFromWishlist(${item.id})">Remove</button>
          </div>
        `;
        wishlistItemsContainer.appendChild(wishlistItem);
      });
    })
    .catch(err => {
      console.error('Error fetching wishlist items:', err);
      wishlistItemsContainer.innerHTML = '<p class="text-center text-red-500">Failed to load wishlist items.</p>';
    });

    function removeFromWishlist(productId) {
      fetch(`/wishlist/${productId}`, {
        method: 'DELETE',
        headers: { Authorization: `Bearer ${token}` },
      })
      .then(res => res.json())
      .then(response => {
        if (response.success) {
          alert('Item removed from wishlist.');
          window.location.reload();
        } else {
          alert('Failed to remove item from wishlist.');
        }
      });
    }
  </script>
</body>
</html>